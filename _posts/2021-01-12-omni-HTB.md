---
layout: post
title: Write-Up Máquina Omni HTB
date: 2021-01-12 23:28 +0800
last_modified_at: 2021-01-12 23:28 +0800
tags: [htb, writeup, python, IoT, windows, core, powershell]
toc:  false
---

![imagen](/assets/imagenes/2021-01-12-omni-HTB/omni-card.png)

---

La máquina Omni es una máquina en la cual esta corriendo un windows IoT core con el portal de gestion en modo Dev. Para la explotacion nos vamos a aprovechar del  Sirep Test Service que es un componente del propio IoT core para realizar comprobaciones en el hardware.

---
## Escaneo

----

![Escaneo](/assets/imagenes/2021-01-12-omni-HTB/escaneo-omni.png)

---

Una vez realizado el escaneo, podemos ver varios puertos abiertos, entre ellos el 8080. En este caso es el que nos interesa, ya que el resto de puertos son componentes internos de microsoft que no deberian ser vulnerables.

---

## Puerto 8080

---

Vamos a acceder al puerto 8080 para ver que nos muestra, aunque ya nos podemos hacer una idea de lo que es viendo el escaneo. 
si nos fijamos bien, vemos que tenemos http-auth, lo que quiere decir que seguramente sea algun panel de gestión protegido por usuario y contraseña.
Un poco más abajo, nos saca un mensaje: "Basic realm=Windows Device Portal"
Esto nos puede indicar el producto concreto que este corriendo en ese puerto.

---

![login](/assets/imagenes/2021-01-12-omni-HTB/panel-login-8080-omni.png)

---

Como podemos ver, efectivamente tenemos un login del cual no tenemos en un principio credenciales.
Vamos a intentar buscar en internet sobre este producto en busca de posibles credenciales por defecto.

---

![creds](/assets/imagenes/2021-01-12-omni-HTB/creds-default-device-portal.png)

---

El primer resultado ya nos muestra que este servicio tiene credenciales por defecto.
Vamos a probarlas.

---

![login-creds](/assets/imagenes/2021-01-12-omni-HTB/test-creds.png)

---

Si le damos ok vemos que volvemos al login por lo que esas credenciales no valen en esta máquina.
Ya que tenemos el nombre del producto que esta corriendo, vamos a buscar posibles exploits.

---
Si buscamos en google 'windows device portal exploit' nos aparecera el siguiente artículo: 
![articulo](/assets/imagenes/2021-01-12-omni-HTB/articulo-exploit-iot-core.png)

---

Este artículo hace referencia a una herramienta de explotacion desarrollada en python en el año 2019 llamada [SirepRAT](https://github.com/SafeBreach-Labs/SirepRAT).
Esta tool se aprovecha del Sirep Test Service que es una funcionalidad nativa de los sistemas windows IoT core que se usa de manera legitima para realizar pruebas de drivers y hardware en el propio dispositivo IoT.




